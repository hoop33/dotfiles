(function() {
  var Dialog, Point, emmet, resources, tabStops, utilsCommon;

  Point = require('atom').Point;

  emmet = require('../vendor/emmet-app').emmet;

  utilsCommon = emmet.require('utils/common');

  tabStops = emmet.require('assets/tabStops');

  resources = emmet.require("assets/resources");

  Dialog = require('./dialog');

  module.exports = {
    setupContext: function(editorView) {
      this.editorView = editorView;
      this.editor = this.editorView.getEditor();
      this.indentation = this.editor.getTabText();
      resources.setVariable("indentation", this.indentation);
      return this.syntax = this.getSyntax();
    },
    getSelectionRange: function() {
      var range;
      range = this.editor.getSelection().getBufferRange();
      return {
        start: this.editor.getBuffer().characterIndexForPosition(range.start),
        end: this.editor.getBuffer().characterIndexForPosition(range.end)
      };
    },
    createSelection: function(start, end) {
      return this.editor.getSelection().setBufferRange({
        start: this.editor.getBuffer().positionForCharacterIndex(start),
        end: this.editor.getBuffer().positionForCharacterIndex(end)
      });
    },
    getCurrentLineRange: function() {
      var index, lineLength, row;
      row = this.editor.getCursor().getBufferRow();
      lineLength = this.editor.lineLengthForBufferRow(row);
      index = this.editor.getBuffer().characterIndexForPosition({
        row: row,
        column: 0
      });
      return {
        start: index,
        end: index + lineLength
      };
    },
    getCaretPos: function() {
      var column, row;
      row = this.editor.getCursor().getBufferRow();
      column = this.editor.getCursor().getBufferColumn();
      return this.editor.getBuffer().characterIndexForPosition({
        row: row,
        column: column
      });
    },
    setCaretPos: function(index) {
      var pos;
      pos = this.editor.getBuffer().positionForCharacterIndex(index);
      this.editor.getSelection().clear();
      return this.editor.setCursorBufferPosition(pos);
    },
    getCurrentLine: function() {
      var row;
      row = this.editor.getCursor().getBufferRow();
      return this.editor.lineForBufferRow(row);
    },
    replaceContent: function(value, start, end, noIndent) {
      var changeRange, cursorRange, firstTabStop, tabstopData;
      if (end == null) {
        end = start == null ? this.getContent().length : start;
      }
      if (start == null) {
        start = 0;
      }
      if (!noIndent) {
        value = utilsCommon.padString(value, utilsCommon.getLinePaddingFromPosition(this.getContent(), start));
      }
      tabstopData = tabStops.extract(value, {
        escape: function(ch) {
          return ch;
        }
      });
      value = tabstopData.text.replace(/\t/g, this.editorView.editor.getTabText());
      firstTabStop = tabstopData.tabstops[0];
      if (firstTabStop) {
        firstTabStop.start += start;
        firstTabStop.end += start;
      } else {
        firstTabStop = {
          start: value.length + start,
          end: value.length + start
        };
      }
      changeRange = [Point.fromObject(this.editor.getBuffer().positionForCharacterIndex(start)), Point.fromObject(this.editor.getBuffer().positionForCharacterIndex(end))];
      this.editor.getBuffer().change(changeRange, value);
      cursorRange = {};
      cursorRange.start = Point.fromObject(this.editor.getBuffer().positionForCharacterIndex(firstTabStop.start));
      cursorRange.end = Point.fromObject(this.editor.getBuffer().positionForCharacterIndex(firstTabStop.end));
      if (value !== this.editor.getTabText()) {
        return this.editor.getSelection().setBufferRange(cursorRange);
      }
    },
    getContent: function() {
      return this.editor.getText();
    },
    getSyntax: function() {
      var scope, scopes, _i, _len;
      scopes = this.editor.getCursorScopes();
      for (_i = 0, _len = scopes.length; _i < _len; _i++) {
        scope = scopes[_i];
        if (/html/.test(scope)) {
          return "html";
        } else if (/css/.test(scope)) {
          return "css";
        }
      }
    },
    getProfileName: function() {
      return this.editor.getGrammar().name;
    },
    getSelection: function() {
      return this.editor.getSelectedText();
    },
    getFilePath: function() {
      return this.editor.buffer.file.path;
    },
    setSavedText: function(text) {
      return this.savedText = text;
    },
    getSavedText: function() {
      return this.savedText;
    },
    prompt: function(message, callerContext, text, caller, callerArgs) {
      var copy;
      if (text == null) {
        text = null;
      }
      if (caller == null) {
        caller = null;
      }
      if (callerArgs == null) {
        callerArgs = null;
      }
      if (text !== null) {
        callerArgs[0].setSavedText(text);
        return caller.apply(callerContext, callerArgs);
      } else if (this.getSavedText() != null) {
        copy = this.getSavedText();
        this.setSavedText(null);
        return copy;
      } else {
        caller = arguments.callee.caller;
        callerArgs = caller["arguments"];
        new Dialog(message, this.prompt, {
          caller: caller,
          callerArgs: callerArgs,
          callerContext: callerContext
        });
        return "";
      }
    }
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICIiLAogICJzb3VyY2VSb290IjogIiIsCiAgInNvdXJjZXMiOiBbCiAgICAiIgogIF0sCiAgIm5hbWVzIjogW10sCiAgIm1hcHBpbmdzIjogIkFBQUE7QUFBQSxNQUFBLHNEQUFBOztBQUFBLEVBQUMsUUFBUyxPQUFBLENBQVEsTUFBUixFQUFULEtBQUQsQ0FBQTs7QUFBQSxFQUVBLEtBQUEsR0FBUSxPQUFBLENBQVEscUJBQVIsQ0FBOEIsQ0FBQyxLQUZ2QyxDQUFBOztBQUFBLEVBR0EsV0FBQSxHQUFjLEtBQUssQ0FBQyxPQUFOLENBQWMsY0FBZCxDQUhkLENBQUE7O0FBQUEsRUFJQSxRQUFBLEdBQVcsS0FBSyxDQUFDLE9BQU4sQ0FBYyxpQkFBZCxDQUpYLENBQUE7O0FBQUEsRUFLQSxTQUFBLEdBQVksS0FBSyxDQUFDLE9BQU4sQ0FBYyxrQkFBZCxDQUxaLENBQUE7O0FBQUEsRUFNQSxNQUFBLEdBQVMsT0FBQSxDQUFRLFVBQVIsQ0FOVCxDQUFBOztBQUFBLEVBUUEsTUFBTSxDQUFDLE9BQVAsR0FDRTtBQUFBLElBQUEsWUFBQSxFQUFjLFNBQUUsVUFBRixHQUFBO0FBQ1osTUFEYSxJQUFDLENBQUEsYUFBQSxVQUNkLENBQUE7QUFBQSxNQUFBLElBQUMsQ0FBQSxNQUFELEdBQVUsSUFBQyxDQUFBLFVBQVUsQ0FBQyxTQUFaLENBQUEsQ0FBVixDQUFBO0FBQUEsTUFDQSxJQUFDLENBQUEsV0FBRCxHQUFlLElBQUMsQ0FBQSxNQUFNLENBQUMsVUFBUixDQUFBLENBRGYsQ0FBQTtBQUFBLE1BRUEsU0FBUyxDQUFDLFdBQVYsQ0FBc0IsYUFBdEIsRUFBcUMsSUFBQyxDQUFBLFdBQXRDLENBRkEsQ0FBQTthQUdBLElBQUMsQ0FBQSxNQUFELEdBQVUsSUFBQyxDQUFBLFNBQUQsQ0FBQSxFQUpFO0lBQUEsQ0FBZDtBQUFBLElBU0EsaUJBQUEsRUFBbUIsU0FBQSxHQUFBO0FBQ2pCLFVBQUEsS0FBQTtBQUFBLE1BQUEsS0FBQSxHQUFRLElBQUMsQ0FBQSxN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
//# sourceURL=/Users/rwarner/Dropbox/config/.atom/packages/emmet/lib/editor-proxy.coffee